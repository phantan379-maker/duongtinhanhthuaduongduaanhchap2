<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üèçÔ∏è ƒê∆Ø·ªúNG ƒêUA CH√ÇN L√ù - Absolute Cinema Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&family=Bebas+Neue&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { margin: 0; padding: 0; font-family: 'Orbitron', monospace; overflow: hidden; background: #000; }
    html, body, .game-wrapper { height: 100%; width: 100%; }
    
    /* FILM GRAIN OVERLAY */
    .film-grain {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none; z-index: 9999;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      opacity: 0.03;
      animation: grainAnim 0.5s steps(10) infinite;
    }
    @keyframes grainAnim { 0%, 100% { transform: translate(0, 0); } 50% { transform: translate(-5%, -5%); } }

    /* VIGNETTE */
    .vignette {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none; z-index: 9998;
      background: radial-gradient(ellipse at center, transparent 0%, transparent 50%, rgba(0,0,0,0.8) 100%);
    }

    /* SCANLINES */
    .scanlines {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none; z-index: 9997;
      background: repeating-linear-gradient(0deg, transparent 0px, transparent 2px, rgba(0,0,0,0.1) 2px, rgba(0,0,0,0.1) 4px);
    }

    .game-wrapper { 
      background: linear-gradient(180deg, #0a0e27 0%, #1a1a2e 50%, #0f3460 100%); 
      display: flex; flex-direction: column; position: relative; overflow: hidden; 
    }

    /* CINEMATIC INTRO */
    .cinematic-intro {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: #000; z-index: 1000;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .intro-text {
      color: #fff; font-size: 1.5rem; text-align: center; max-width: 800px;
      line-height: 2; opacity: 0; font-family: 'Rajdhani', sans-serif;
      animation: fadeInText 3s ease-out forwards;
    }
    @keyframes fadeInText { 0% { opacity: 0; transform: translateY(30px); } 100% { opacity: 1; transform: translateY(0); } }
    
    .studio-logo {
      font-size: 1rem; color: #666; letter-spacing: 10px; text-transform: uppercase;
      margin-bottom: 50px; opacity: 0;
      animation: fadeInText 2s ease-out forwards;
    }
    .presents-text {
      font-size: 2rem; color: #888; font-family: 'Bebas Neue', cursive;
      letter-spacing: 15px; margin-bottom: 30px; opacity: 0;
      animation: fadeInText 2s ease-out 1s forwards;
    }
    .main-title-intro {
      font-size: 5rem; font-weight: 900; 
      background: linear-gradient(135deg, #ff0000, #ff6b00, #ffff00, #00ff41);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: none;
      margin-bottom: 20px; opacity: 0;
      animation: titleReveal 2s ease-out 2s forwards;
    }
    @keyframes titleReveal { 
      0% { opacity: 0; transform: scale(3) rotate(-10deg); filter: blur(20px); } 
      100% { opacity: 1; transform: scale(1) rotate(0deg); filter: blur(0); } 
    }
    .subtitle-intro {
      font-size: 1.5rem; color: #00ff41; letter-spacing: 5px;
      opacity: 0; animation: fadeInText 2s ease-out 3s forwards;
    }
    .skip-btn {
      position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%);
      padding: 18px 60px; 
      background: linear-gradient(135deg, #ff0000, #ff6b00);
      border: 3px solid #ffff00; border-radius: 10px;
      color: #fff; cursor: pointer; font-family: 'Orbitron'; font-size: 1.2rem;
      font-weight: 900; text-transform: uppercase;
      opacity: 0; animation: fadeInText 2s ease-out 4s forwards;
      box-shadow: 0 0 30px rgba(255,0,0,0.5);
      transition: 0.3s;
    }
    .skip-btn:hover { 
      transform: translateX(-50%) scale(1.05); 
      box-shadow: 0 0 50px rgba(255,0,0,0.8); 
    }

    /* START SCREEN */
    .start-screen { 
      display: none; flex-direction: column; align-items: center; justify-content: center; 
      height: 100%; padding: 2rem; text-align: center; position: relative; z-index: 10; 
    }
    
    .neon-title { 
      font-size: 4rem; font-weight: 900; color: #00ff41; 
      text-shadow: 0 0 10px #00ff41, 0 0 20px #00ff41, 0 0 40px #00ff41, 0 0 80px #00ff41; 
      margin-bottom: 1rem; animation: flicker 3s infinite alternate; 
    }
    @keyframes flicker { 0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { text-shadow: 0 0 10px #00ff41, 0 0 20px #00ff41, 0 0 40px #00ff41; } 20%, 24%, 55% { text-shadow: none; } }
    
    .story-intro { 
      font-size: 1.1rem; color: #ffffff; max-width: 700px; line-height: 1.8; margin-bottom: 2rem; 
      background: rgba(0, 0, 0, 0.7); padding: 1.5rem; border-radius: 15px; 
      border: 2px solid #00ff41; font-family: 'Rajdhani', sans-serif; 
      backdrop-filter: blur(10px);
    }
    .story-intro strong { color: #ff0000; }
    .story-intro .reward { color: #ffff00; }
    
    .start-input { 
      width: 100%; max-width: 450px; padding: 1.2rem 2rem; font-size: 1.2rem; 
      border: 3px solid #00ff41; border-radius: 10px; background: rgba(0, 0, 0, 0.8); 
      color: #00ff41; margin-bottom: 2rem; text-align: center; font-weight: 700; 
      font-family: 'Orbitron';
      box-shadow: 0 0 20px rgba(0,255,65,0.3), inset 0 0 20px rgba(0,255,65,0.1);
    }
    .start-input::placeholder { color: rgba(0,255,65,0.5); }
    .start-input:focus { outline: none; box-shadow: 0 0 40px rgba(0,255,65,0.6); }
    
    .start-button { 
      padding: 1.2rem 4rem; font-size: 1.4rem; font-weight: 900; 
      background: linear-gradient(135deg, #ff0000 0%, #ff6b00 100%); 
      color: white; border: 3px solid #ffff00; border-radius: 10px; cursor: pointer; 
      transition: all 0.3s; box-shadow: 0 0 20px rgba(255, 0, 0, 0.6); 
      font-family: 'Orbitron'; text-transform: uppercase;
      position: relative; overflow: hidden;
    }
    .start-button::before {
      content: ''; position: absolute; top: -50%; left: -50%;
      width: 200%; height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
      transform: rotate(45deg); transition: 0.5s;
    }
    .start-button:hover::before { left: 100%; }
    .start-button:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 0 60px rgba(255, 0, 0, 0.8); }

    /* RACING SCREEN */
    .racing-screen { display: none; height: 100%; position: relative; overflow: hidden; }
    
    .highway-container { 
      height: 100%; width: 100%; position: relative; 
      background: linear-gradient(180deg, #1a0a2e 0%, #0a1628 50%, #000 100%); 
      perspective: 1200px; overflow: hidden; 
    }
    
    /* NEON CITY BACKGROUND */
    .city-bg {
      position: absolute; top: 0; left: 0; right: 0; height: 40%;
      background: linear-gradient(180deg, #0a0a2e 0%, #1a1a3e 100%);
      overflow: hidden;
    }
    .city-building {
      position: absolute; bottom: 0;
      background: linear-gradient(180deg, #1a1a3e, #0a0a1e);
      border: 1px solid rgba(0,255,255,0.2);
    }
    .city-building::after {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: repeating-linear-gradient(0deg, transparent 0px, transparent 10px, rgba(0,255,255,0.1) 10px, rgba(0,255,255,0.1) 12px);
    }
    .neon-sign {
      position: absolute; padding: 5px 15px; font-size: 0.8rem;
      background: rgba(255,0,100,0.8); color: #fff;
      animation: neonBlink 2s infinite;
    }
    @keyframes neonBlink { 0%, 50%, 100% { opacity: 1; } 25%, 75% { opacity: 0.5; } }
    
    .road { 
      position: absolute; bottom: 0; left: 0; right: 0; height: 60%; 
      background: repeating-linear-gradient(0deg, #0a0a0a 0px, #0a0a0a 50px, #151515 50px, #151515 100px); 
      animation: roadScroll 0.5s linear infinite; 
      transform: rotateX(25deg); transform-origin: bottom; 
    }
    .road.slow-motion { animation: roadScroll 4s linear infinite; }
    @keyframes roadScroll { from { background-position: 0 0; } to { background-position: 0 100px; } }
    
    /* SPEED LINES */
    .speed-lines {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none; overflow: hidden;
    }
    .speed-line {
      position: absolute; width: 3px; height: 100px;
      background: linear-gradient(180deg, transparent, #00ff41, transparent);
      animation: speedLineAnim 0.3s linear infinite;
      opacity: 0.3;
    }
    @keyframes speedLineAnim { from { transform: translateY(-100px); } to { transform: translateY(100vh); } }
    
    .lane-lines { position: absolute; top: 0; bottom: 0; left: 0; right: 0; display: flex; justify-content: space-around; padding: 0 10%; }
    .lane-line { 
      width: 6px; height: 100%; 
      background: repeating-linear-gradient(0deg, #ffff00 0px, #ffff00 40px, transparent 40px, transparent 80px); 
      animation: laneScroll 0.5s linear infinite; 
      box-shadow: 0 0 10px #ffff00;
    }
    .lane-line.slow-motion { animation: laneScroll 4s linear infinite; }
    @keyframes laneScroll { from { background-position: 0 0; } to { background-position: 0 80px; } }
    
    /* OBSTACLES */
    .obstacle { position: absolute; bottom: 40%; transform: translateX(-50%); z-index: 95; display: none; }
    .rock-graphic { 
      width: 100px; height: 80px; 
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 50%, #7f1d1d 100%); 
      border-radius: 50% 60% 60% 50% / 60% 40% 60% 40%; 
      border: 4px solid #ff0000; 
      box-shadow: 0 0 30px rgba(255,0,0,0.8), inset -15px -15px 0 rgba(0,0,0,0.4); 
      position: relative;
      animation: rockGlow 1s infinite alternate;
    }
    @keyframes rockGlow { 0% { box-shadow: 0 0 30px rgba(255,0,0,0.5); } 100% { box-shadow: 0 0 50px rgba(255,0,0,1); } }
    .rock-graphic::before { 
      content: 'üíÄ'; position: absolute; top: 50%; left: 50%; 
      transform: translate(-50%, -50%); font-size: 2rem; 
    }
    .obstacle.lane-a { left: 15%; } .obstacle.lane-b { left: 38%; } .obstacle.lane-c { left: 62%; } .obstacle.lane-d { left: 85%; }

    /* EXPLOSION */
    .explosion-container { 
      position: absolute; bottom: 40%; transform: translate(-50%, 50%); 
      z-index: 150; display: none; pointer-events: none; 
    }
    .explosion-container.active { display: block; }
    .explosion-core { 
      width: 30px; height: 30px; border-radius: 50%; 
      background: radial-gradient(circle, #fff 0%, #ffeb3b 20%, #ff9800 40%, #f44336 70%, transparent 100%); 
      animation: explosionAnim 1s ease-out forwards; 
      box-shadow: 0 0 50px #ff9800, 0 0 100px #ff0000; 
    }
    .explosion-text { 
      position: absolute; top: -80px; left: 50%; 
      transform: translateX(-50%) scale(0); color: #ffff00; 
      font-weight: 900; font-size: 4rem; font-style: italic; 
      text-shadow: 4px 4px 0 #ff0000, -4px -4px 0 #ff6b00; 
      animation: textPop 0.8s ease-out forwards; white-space: nowrap; 
    }
    @keyframes explosionAnim { 0% { transform: scale(1); opacity: 1; } 30% { transform: scale(15); opacity: 1; } 100% { transform: scale(20); opacity: 0; } }
    @keyframes textPop { 0% { transform: translateX(-50%) scale(0) rotate(-15deg); opacity: 0; } 50% { transform: translateX(-50%) scale(1.8) rotate(10deg); opacity: 1; } 100% { transform: translateX(-50%) scale(1.2) rotate(0deg); opacity: 0; top: -150px; } }
    .explosion-container.lane-a { left: 15%; } .explosion-container.lane-b { left: 38%; } .explosion-container.lane-c { left: 62%; } .explosion-container.lane-d { left: 85%; }

    /* BIKE */
    .bike { 
      position: absolute; bottom: 15%; left: 50%; transform: translateX(-50%); 
      font-size: 6rem; z-index: 100; 
      transition: left 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); 
      filter: drop-shadow(0 0 30px rgba(0, 255, 65, 0.8)); 
    }
    .bike::after {
      content: ''; position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%);
      width: 60px; height: 20px;
      background: radial-gradient(ellipse, rgba(0,255,65,0.5), transparent);
      border-radius: 50%;
    }
    .bike.crashed { 
      animation: crashShake 0.5s ease-in-out; 
      filter: sepia(1) hue-rotate(-50deg) saturate(5) brightness(0.6) drop-shadow(0 0 50px rgba(255,0,0,1)); 
    }
    @keyframes crashShake { 
      0% { transform: translateX(-50%) rotate(0deg); } 
      10%, 90% { transform: translateX(-60%) rotate(-15deg); } 
      20%, 80% { transform: translateX(-40%) rotate(15deg); } 
      30%, 70% { transform: translateX(-55%) rotate(-10deg); } 
      100% { transform: translateX(-50%) rotate(0deg); } 
    }
    .bike.lane-a { left: 15%; } .bike.lane-b { left: 38%; } .bike.lane-c { left: 62%; } .bike.lane-d { left: 85%; }

    /* HUD */
    .hud { 
      position: absolute; top: 0; left: 0; right: 0; padding: 1.5rem 2rem; 
      display: flex; justify-content: space-between; align-items: center;
      z-index: 200; pointer-events: none; 
      background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%);
    }
    .hud-item { 
      background: rgba(0, 0, 0, 0.9); padding: 0.8rem 1.5rem; 
      border: 2px solid #00ff41; font-size: 1.1rem; color: #00ff41; 
      font-weight: 700; text-shadow: 0 0 10px #00ff41; 
      clip-path: polygon(10px 0, 100% 0, calc(100% - 10px) 100%, 0 100%);
    }
    .hud-score { 
      border-color: #ffff00; color: #ffff00; 
      text-shadow: 0 0 10px #ffff00;
      font-size: 1.3rem;
    }
    
    /* QUESTION PANEL */
    .question-panel { 
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
      background: rgba(0, 0, 0, 0.98); padding: 2.5rem; 
      border: 4px solid #00ff41; width: 850px; max-width: 95%; z-index: 300; 
      display: none; box-shadow: 0 0 60px rgba(0, 255, 65, 0.8), inset 0 0 60px rgba(0,255,65,0.1); 
      text-align: center; 
      clip-path: polygon(20px 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%, 0 20px);
    }
    .bullet-time-text { 
      color: #00d9ff; font-size: 1.3rem; text-transform: uppercase; 
      letter-spacing: 5px; margin-bottom: 1.5rem; animation: pulse 1s infinite; 
    }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .question-text { 
      font-size: 1.4rem; color: #fff; margin-bottom: 2rem; line-height: 1.8; 
      font-family: 'Rajdhani'; font-weight: bold;
    }
    .countdown { 
      font-size: 4rem; color: #ff0000; font-weight: 900; 
      text-shadow: 0 0 30px #ff0000;
      animation: countdownPulse 1s infinite;
    }
    @keyframes countdownPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

    /* LANE CHOICES */
    .lane-choices { 
      position: absolute; bottom: 0; left: 0; right: 0; height: 35%; 
      display: flex; z-index: 250; pointer-events: all; 
    }
    .lane-choice { 
      flex: 1; 
      background: linear-gradient(180deg, rgba(0, 255, 65, 0.05) 0%, rgba(0, 255, 65, 0.2) 100%); 
      border: 2px solid rgba(0, 255, 65, 0.3); cursor: pointer; 
      display: flex; flex-direction: column; justify-content: center; align-items: center; 
      padding: 1rem; transition: 0.3s; position: relative; overflow: hidden;
    }
    .lane-choice::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(180deg, transparent 0%, rgba(0,255,65,0.3) 100%);
      opacity: 0; transition: 0.3s;
    }
    .lane-choice:hover::before { opacity: 1; }
    .lane-choice:hover { 
      border: 3px solid #00ff41; 
      box-shadow: 0 0 30px rgba(0,255,65,0.5), inset 0 0 30px rgba(0,255,65,0.2);
    }
    .lane-label { 
      font-size: 3rem; font-weight: 900; color: #00ff41; 
      text-shadow: 0 0 20px #00ff41; z-index: 2;
    }
    .lane-answer { 
      color: #fff; text-align: center; margin-top: 15px; 
      font-family: 'Rajdhani'; font-weight: bold; font-size: 1.1rem;
      z-index: 2; line-height: 1.4;
    }
    .lane-choice.correct { 
      background: rgba(0, 255, 0, 0.6); border-color: #00ff00; 
      animation: correctFlash 0.5s ease-out;
    }
    @keyframes correctFlash { 0% { background: #fff; } 100% { background: rgba(0, 255, 0, 0.6); } }
    .lane-choice.incorrect { 
      background: rgba(255, 0, 0, 0.6); border-color: #ff0000; 
      animation: incorrectShake 0.5s ease-out;
    }
    @keyframes incorrectShake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-10px); } 40%, 80% { transform: translateX(10px); } }

    /* FLASHBACK */
    .flashback-overlay { 
      position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
      background: rgba(0, 0, 0, 0.98); z-index: 400; display: none; 
      flex-direction: column; justify-content: center; align-items: center; 
    }
    .flashback-title { 
      font-size: 3.5rem; color: #ff0000; text-transform: uppercase; 
      animation: glitchText 0.1s infinite; 
      margin-bottom: 30px;
    }
    @keyframes glitchText {
      0% { text-shadow: 2px 0 #ff0000, -2px 0 #00ff41; }
      50% { text-shadow: -2px 0 #ff0000, 2px 0 #00ff41; }
      100% { text-shadow: 2px 0 #ff0000, -2px 0 #00ff41; }
    }
    .flashback-scene { font-size: 8rem; margin: 30px 0; animation: explodeEmoji 1s ease-out; }
    @keyframes explodeEmoji { 0% { transform: scale(0) rotate(-180deg); opacity: 0; } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
    .flashback-text { 
      color: #fff; max-width: 700px; text-align: center; font-size: 1.6rem; 
      line-height: 1.8; border: 3px solid red; padding: 30px; 
      background: rgba(255,0,0,0.1); font-family: 'Rajdhani';
    }

    /* EXPLANATION PANEL */
    .explanation-panel { 
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
      background: rgba(0,0,0,0.98); border: 4px solid #00d9ff; padding: 2.5rem; 
      width: 850px; max-width: 95%; z-index: 350; display: none; text-align: center; 
      box-shadow: 0 0 60px rgba(0,217,255,0.5);
    }
    .explanation-title { font-size: 2.2rem; margin-bottom: 1.5rem; font-weight: bold; }
    .explanation-title.correct { color: #00ff00; text-shadow: 0 0 20px #00ff00; }
    .explanation-title.incorrect { color: #ff0000; text-shadow: 0 0 20px #ff0000; }
    .explanation-text { 
      color: #fff; font-size: 1.3rem; margin-bottom: 2.5rem; 
      font-family: 'Rajdhani'; line-height: 1.6;
    }
    .next-button { 
      padding: 1rem 4rem; font-size: 1.3rem; 
      background: linear-gradient(135deg, #00ff41, #00d9ff); 
      border: none; cursor: pointer; font-weight: bold; text-transform: uppercase; 
      font-family: 'Orbitron'; color: #000;
      transition: 0.3s; position: relative; overflow: hidden;
    }
    .next-button:hover { transform: scale(1.05); box-shadow: 0 0 30px rgba(0,255,65,0.8); }

    /* RESULTS */
    .results-screen { 
      display: none; flex-direction: column; align-items: center; justify-content: center; 
      height: 100%; color: #fff; padding: 2rem;
    }
    .results-trophy { font-size: 8rem; animation: trophySpin 3s ease-out; }
    @keyframes trophySpin { 0% { transform: rotateY(0deg) scale(0); } 100% { transform: rotateY(720deg) scale(1); } }
    .results-title { 
      font-size: 4rem; color: #ffff00; margin: 20px 0;
      text-shadow: 0 0 30px #ffff00;
      animation: fadeInText 1s ease-out;
    }
    .results-score { 
      font-size: 3.5rem; color: #00ff41; margin: 20px 0; 
      text-shadow: 0 0 30px #00ff41; 
    }
    .results-message { 
      font-size: 1.5rem; max-width: 700px; text-align: center; 
      margin-bottom: 40px; font-family: 'Rajdhani'; line-height: 1.8;
    }
    .restart-button {
      padding: 1rem 3rem; font-size: 1.2rem;
      background: linear-gradient(135deg, #ff0000, #ff6b00);
      color: #fff; border: 3px solid #ffff00; cursor: pointer;
      font-family: 'Orbitron'; font-weight: bold;
      transition: 0.3s;
    }
    .restart-button:hover { transform: scale(1.1); box-shadow: 0 0 30px rgba(255,0,0,0.8); }

    /* LUCKY WHEEL - FIXED VERSION */
    .wheel-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: radial-gradient(ellipse at center, rgba(50,0,100,0.95) 0%, rgba(0,0,0,0.98) 100%);
      z-index: 900; display: none;
      flex-direction: column; align-items: center; justify-content: center;
    }
    .wheel-header {
      font-size: 3rem; color: #fff; margin-bottom: 20px;
      text-transform: uppercase;
      text-shadow: 0 0 30px #ff00de, 0 0 60px #ff00de;
      animation: wheelHeaderGlow 2s infinite alternate;
    }
    @keyframes wheelHeaderGlow { 0% { text-shadow: 0 0 30px #ff00de; } 100% { text-shadow: 0 0 60px #00ff41, 0 0 100px #00ff41; } }
    
    .wheel-subtext {
      font-size: 1.2rem; color: #ffff00; margin-bottom: 30px;
      font-family: 'Rajdhani'; letter-spacing: 3px;
    }
    
    /* FIX: Wheel container with fixed aspect ratio */
    .wheel-container { 
      position: relative; 
      width: min(380px, 80vmin);
      height: min(380px, 80vmin);
      margin-bottom: 30px;
      aspect-ratio: 1 / 1;
    }
    
    .wheel-pointer {
      position: absolute; top: -35px; left: 50%; transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 30px solid transparent; border-right: 30px solid transparent;
      border-top: 60px solid #ff0000;
      z-index: 10; filter: drop-shadow(0 5px 15px rgba(255,0,0,0.8));
      animation: pointerGlow 1s infinite alternate;
    }
    @keyframes pointerGlow {
      0% { filter: drop-shadow(0 5px 15px rgba(255,0,0,0.5)); }
      100% { filter: drop-shadow(0 5px 25px rgba(255,0,0,1)); }
    }
    .wheel-pointer::after {
      content: '‚ñº'; position: absolute; top: -55px; left: 50%; transform: translateX(-50%);
      font-size: 1.5rem; color: #ffff00;
      text-shadow: 0 0 10px #ffff00;
    }
    
    /* FIX: Wheel with SVG-based segments for perfect circles */
    .wheel {
      width: 100%; 
      height: 100%; 
      border-radius: 50%;
      position: relative; 
      overflow: hidden;
      transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99);
      box-shadow: 
        0 0 0 8px #8B4513,
        0 0 0 12px #ffd700,
        0 0 60px rgba(255, 215, 0, 0.8), 
        inset 0 0 50px rgba(0,0,0,0.3);
      /* Force GPU rendering for smoother animation */
      will-change: transform;
      transform-style: preserve-3d;
      backface-visibility: hidden;
    }
    
    /* FIX: Use SVG for perfect wheel segments */
    .wheel-svg {
      width: 100%;
      height: 100%;
      display: block;
    }
    
    /* Logo T√†i X·ªâu ·ªü t√¢m */
    .wheel-center {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 25%; height: 25%; 
      background: linear-gradient(135deg, #1a1a2e 0%, #0f0f23 100%);
      border-radius: 50%; 
      border: 5px solid #ffd700;
      display: flex; align-items: center; justify-content: center; flex-direction: column;
      box-shadow: 0 0 30px rgba(255,215,0,0.8), inset 0 0 20px rgba(255,255,255,0.1);
      overflow: hidden;
      z-index: 5;
    }
    .wheel-center-logo {
      font-size: 2rem;
      width: 90px; height: 90px;
      border-radius: 50%;
      background: url('https://media.discordapp.net/attachments/1433133504635338944/1462134611415929035/5vAnQtPSRUw9ZAAAAAElFTkSuQmCC.png?ex=696d1678&is=696bc4f8&hm=8ac055d32666400450209c804b08b031a3e001f4148fc0f4bddd681a5595b894&=&format=webp&quality=lossless') center/cover no-repeat;
      /* Fallback n·∫øu ·∫£nh kh√¥ng load */
      display: flex; align-items: center; justify-content: center;
    }
    
    .wheel-labels { 
      position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
      pointer-events: none;
    }
    .segment-label {
      position: absolute; 
      top: 50%; 
      left: 50%;
      width: 38%;
      text-align: right;
      padding-right: 5px;
      font-weight: 900; 
      font-size: clamp(0.6rem, 2vmin, 1rem);
      color: #fff;
      text-shadow: 2px 2px 4px #000, 0 0 10px rgba(0,0,0,0.8);
      display: flex; 
      align-items: center; 
      justify-content: flex-end;
      transform-origin: 0% 50%;
      white-space: nowrap;
    }
    
    .spin-btn {
      padding: 20px 70px; font-size: 1.8rem;
      background: linear-gradient(135deg, #ff0000, #ff6b00);
      color: white; border: 5px solid #ffff00; border-radius: 60px;
      cursor: pointer; font-family: 'Orbitron'; font-weight: 900;
      box-shadow: 0 10px 0 #990000, 0 0 50px rgba(255,0,0,0.6);
      transition: 0.1s; text-transform: uppercase;
      animation: btnPulse 2s infinite;
    }
    @keyframes btnPulse {
      0%, 100% { box-shadow: 0 10px 0 #990000, 0 0 30px rgba(255,0,0,0.5); }
      50% { box-shadow: 0 10px 0 #990000, 0 0 60px rgba(255,0,0,0.9); }
    }
    .spin-btn:hover { transform: scale(1.05); }
    .spin-btn:active { transform: translateY(5px); box-shadow: 0 5px 0 #990000; }
    .spin-btn:disabled { background: #555; box-shadow: 0 5px 0 #333; cursor: not-allowed; animation: none; }

    /* REWARDS */
    .reward-container { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 500; overflow: hidden; }
    .reward-item { 
      position: absolute; bottom: -50px; font-size: 3rem; 
      animation: floatUp 3s ease-out forwards; 
    }
    @keyframes floatUp { 
      0% { transform: translateY(0) rotate(0deg) scale(0.5); opacity: 0; } 
      10% { opacity: 1; } 
      100% { transform: translateY(-100vh) rotate(360deg) scale(1.2); opacity: 0; } 
    }
    .reward-message-box { 
      position: absolute; top: 30%; left: 50%; 
      transform: translate(-50%, -50%) scale(0); 
      background: linear-gradient(135deg, #00ff41 0%, #00b32e 100%); 
      padding: 1.5rem 4rem; border: 4px solid #fff; border-radius: 60px; 
      text-align: center; z-index: 950; 
      box-shadow: 0 0 50px rgba(0, 255, 65, 1); display: none; 
    }
    .reward-message-box.active { animation: popInMsg 3.5s forwards; display: block; }
    @keyframes popInMsg { 
      0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 
      10% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; } 
      20% { transform: translate(-50%, -50%) scale(1); opacity: 1; } 
      80% { transform: translate(-50%, -50%) scale(1); opacity: 1; } 
      100% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 
    }
    .reward-title { font-size: 1.3rem; color: #fff; font-weight: bold; margin-bottom: 5px; }
    .reward-name { 
      font-size: 2.8rem; color: #ffff00; font-weight: 900; 
      text-transform: uppercase; text-shadow: 3px 3px 0 #000; 
    }

    /* CONFETTI */
    .confetti {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none; z-index: 600; display: none;
    }
    .confetti.active { display: block; }
    .confetti-piece {
      position: absolute; width: 10px; height: 10px;
      animation: confettiFall 3s ease-out forwards;
    }
    @keyframes confettiFall {
      0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    /* SCREEN FLASH */
    .screen-flash {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: #fff; pointer-events: none; z-index: 999;
      opacity: 0;
    }
    .screen-flash.active { animation: flashAnim 0.3s ease-out; }
    @keyframes flashAnim { 0% { opacity: 1; } 100% { opacity: 0; } }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .neon-title, .main-title-intro { font-size: 2.5rem; }
      .question-text { font-size: 1.1rem; }
      .lane-answer { font-size: 0.9rem; }
      .wheel-container { width: min(300px, 75vmin); height: min(300px, 75vmin); }
      .segment-label { font-size: clamp(0.5rem, 1.8vmin, 0.85rem); }
      .wheel-header { font-size: 2rem; }
      .spin-btn { padding: 15px 40px; font-size: 1.3rem; }
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <!-- AUDIO ELEMENTS -->
    <!-- Nh·∫°c n·ªÅn intro -->
    <audio id="introMusic" loop>
      <source src="nhacnen.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Nh·∫°c khi b·∫•m kh·ªüi ƒë·ªông xe -->
    <audio id="startEngineMusic">
      <source src="rizz.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Nh·∫°c n·ªÅn game -->
    <audio id="bgMusic" loop>
      <source src="megalovania.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Nh·∫°c quay v√≤ng quay -->
    <audio id="spinMusic">
      <source src="nhacxoso.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Nh·∫°c tr·∫£ l·ªùi ƒë√∫ng -->
    <audio id="correctMusic">
      <source src="tiengdit.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Nh·∫°c tr·∫£ l·ªùi sai -->
    <audio id="wrongMusic">
      <source src="vinhbietcu.mp3" type="audio/mpeg">
    </audio>

    <!-- CINEMATIC OVERLAYS -->
    <div class="film-grain"></div>
    <div class="vignette"></div>
    <div class="scanlines"></div>
    <div class="screen-flash" id="screenFlash"></div>
    <div class="confetti" id="confetti"></div>

    <!-- CINEMATIC INTRO -->
    <div class="cinematic-intro" id="cinematicIntro">
      <div class="studio-logo">Developed by MinhTien </div>
      <div class="presents-text">T·ªî 2 ‚Äì L·ªöP 9/4 PRODUCTIONS ( ‚Ä¢ÃÄ œâ ‚Ä¢ÃÅ )y</div>
      <div class="main-title-intro">üèçÔ∏è ƒê∆Ø·ªúNG ƒêUA CH√ÇN L√ù</div>
      <div class="subtitle-intro">THE TRUTH HIGHWAY</div>
      <button class="skip-btn" id="skipIntro"> B·∫ÆT ƒê·∫¶U CH∆†I</button>
    </div>

    <!-- START SCREEN -->
    <div class="start-screen" id="startScreen">
      <div class="neon-title">üèçÔ∏è ƒê∆Ø·ªúNG ƒêUA CH√ÇN L√ù</div>
      <div class="story-intro">
        <p><strong>üìñ C√ÇU CHUY·ªÜN:</strong> Huy·ªÅn Th∆∞ - m·ªôt h·ªçc sinh c·∫•p 3 - ƒë∆∞·ª£c b·ªë m·∫π mua xe m√°y ƒëi h·ªçc d√π ch∆∞a ƒë·ªß tu·ªïi. M·ªôt ƒë√™m ƒëi ch∆°i c√πng b·∫°n b√®, c√¥ g√¢y ra tai n·∫°n kinh ho√†ng...</p>
        <p>üéÆ <strong>LU·∫¨T CH∆†I:</strong> Tr·∫£ l·ªùi ƒë√∫ng ‚Üí Quay <span class="reward">V√íNG QUAY MAY M·∫ÆN</span> (100% tr√∫ng ti·ªÅn)</p>
        <p>‚ùå Tr·∫£ l·ªùi sai ‚Üí <strong style="color:#ff0000">XE N·ªî!</strong> Xem l·∫°i h·∫≠u qu·∫£ ƒëau th∆∞∆°ng.</p>
      </div>
      <input type="text" class="start-input" id="playerNameInput" placeholder="üë§ NH·∫¨P T√äN C·ª¶A B·∫†N..." maxlength="30">
      <button class="start-button" id="startButton">üî• KH·ªûI ƒê·ªòNG XE üî•</button>
    </div>

    <!-- RACING SCREEN -->
    <div class="racing-screen" id="racingScreen">
      <div class="highway-container">
        <!-- City Background -->
        <div class="city-bg" id="cityBg"></div>
        
        <!-- Speed Lines -->
        <div class="speed-lines" id="speedLines"></div>
        
        <div class="road" id="road">
          <div class="lane-lines">
            <div class="lane-line"></div>
            <div class="lane-line"></div>
            <div class="lane-line"></div>
          </div>
        </div>
        
        <div id="reward-container" class="reward-container"></div>
        
        <div id="obstacles-container">
          <div class="obstacle" id="rock-A"><div class="rock-graphic"></div></div>
          <div class="obstacle" id="rock-B"><div class="rock-graphic"></div></div>
          <div class="obstacle" id="rock-C"><div class="rock-graphic"></div></div>
          <div class="obstacle" id="rock-D"><div class="rock-graphic"></div></div>
        </div>
        
        <div id="explosion" class="explosion-container">
          <div class="explosion-core"></div>
          <div class="explosion-text">üí• B√ôM!</div>
        </div>
        
        <div class="bike" id="bike">üèçÔ∏è</div>
      </div>

      <div class="hud">
        <div class="hud-item" id="levelDisplay">LEVEL 1/7</div>
        <div class="hud-item hud-score" id="scoreDisplay">üíé ƒêI·ªÇM: 0</div>
      </div>

      <div class="question-panel" id="questionPanel">
        <div class="bullet-time-text">‚ö° BULLET TIME ‚ö°</div>
        <div class="question-text" id="questionText">...</div>
        <div class="countdown" id="countdown">10</div>
      </div>

      <div class="lane-choices" id="laneChoices" style="display: none;">
        <div class="lane-choice" data-lane="A">
          <div class="lane-label">A</div>
          <div class="lane-answer" id="answerA"></div>
        </div>
        <div class="lane-choice" data-lane="B">
          <div class="lane-label">B</div>
          <div class="lane-answer" id="answerB"></div>
        </div>
        <div class="lane-choice" data-lane="C">
          <div class="lane-label">C</div>
          <div class="lane-answer" id="answerC"></div>
        </div>
        <div class="lane-choice" data-lane="D">
          <div class="lane-label">D</div>
          <div class="lane-answer" id="answerD"></div>
        </div>
      </div>
      
      <div id="reward-message-box" class="reward-message-box">
        <div class="reward-title">üéâ CH√öC M·ª™NG B·∫†N NH·∫¨N ƒê∆Ø·ª¢C:</div>
        <div class="reward-name" id="reward-name">QU√Ä</div>
      </div>

      <div class="explanation-panel" id="explanationPanel">
        <div class="explanation-title" id="explanationTitle"></div>
        <div class="explanation-text" id="explanationText"></div>
        <button class="next-button" id="nextButton">TI·∫æP T·ª§C ‚ûú</button>
      </div>
    </div>

    <!-- LUCKY WHEEL OVERLAY -->
    <div class="wheel-overlay" id="wheelOverlay">
      <div class="wheel-header">üé∞ V√íNG QUAY MAY M·∫ÆN üé∞</div>
      <div class="wheel-subtext">‚ú® -OKVIP- ‚ú®</div>
      <div class="wheel-container">
        <div class="wheel-pointer"></div>
        <div class="wheel" id="luckyWheel">
          <!-- SVG Wheel for perfect rendering -->
          <svg class="wheel-svg" viewBox="0 0 200 200" preserveAspectRatio="xMidYMid meet">
            <defs>
              <clipPath id="wheelClip">
                <circle cx="100" cy="100" r="100"/>
              </clipPath>
            </defs>
            <g clip-path="url(#wheelClip)" id="wheelSegments">
              <!-- Segments will be generated by JS -->
            </g>
          </svg>
          <div class="wheel-center">
            <div class="wheel-center-logo">üé≤</div>
          </div>
          <div class="wheel-labels" id="wheelLabels"></div>
        </div>
      </div>
      <button class="spin-btn" id="spinBtn">üé≤ QUAY NGAY!</button>
    </div>

    <!-- FLASHBACK -->
    <div class="flashback-overlay" id="flashbackOverlay">
      <div class="flashback-title">‚ö†Ô∏è TAI N·∫†N KINH HO√ÄNG! ‚ö†Ô∏è</div>
      <div class="flashback-scene">üî•üèçÔ∏èüí•üöë</div>
      <div class="flashback-text">
        <strong>H·∫¨U QU·∫¢ TH·∫¢M KH·ªêC!</strong><br><br>
        üìã Ph·∫°t v∆∞·ª£t ƒë√®n ƒë·ªè: 10-14 TRI·ªÜU ƒê·ªíNG<br>
        üìã L√°i xe kh√¥ng b·∫±ng: 2-4 TRI·ªÜU ƒê·ªíNG<br>
        üìã Giao xe cho ng∆∞·ªùi kh√¥ng ƒë·ªß tu·ªïi: 8-10 TRI·ªÜU ƒê·ªíNG<br>
        üìã Ch·ªü qu√° s·ªë ng∆∞·ªùi: 10-14 TRI·ªÜU ƒê·ªíNG<br><br>
        üê∑ Gia ƒë√¨nh ph·∫£i b√°n l·ª£n n·ªôp ph·∫°t!
      </div>
    </div>

    <!-- RESULTS -->
    <div class="results-screen" id="resultsScreen">
      <div class="results-trophy">üèÜ</div>
      <div class="results-title">HO√ÄN TH√ÄNH!</div>
      <div class="results-score" id="finalScore"></div>
      <div class="results-message" id="resultsMessage"></div>
      <button class="restart-button" onclick="location.reload()">üîÑ CH∆†I L·∫†I</button>
    </div>
  </div>

  <script>
    /* ========== DATA ========== */
    const questions = [
      { level: 1, question: "Huy·ªÅn Th∆∞ l√† ng∆∞·ªùi vi ph·∫°m, nh∆∞ng y·∫øu t·ªë n√†o l√† 'nguy√™n nh√¢n g·ªëc' t·∫°o ƒëi·ªÅu ki·ªán cho sai ph·∫°m n√†y?", options: { A: "Th∆∞ thi·∫øu hi·ªÉu bi·∫øt lu·∫≠t", B: "B·∫°n b√® r·ªß r√™", C: "Gia ƒë√¨nh cho ph√©p ƒëi xe khi ch∆∞a ƒë·ªß tu·ªïi", D: "Qu·∫£n l√Ω l·ªèng l·∫ªo" }, correct: "C", explanation: "üéØ G·ªêC R·ªÑ N·∫∞M ·ªû S·ª∞ NU√îNG CHI·ªÄU SAI L·∫¶M C·ª¶A PH·ª§ HUYNH! B·ªë m·∫π Th∆∞ ƒë√£ mua xe m√°y (Exciter) cho con d√π bi·∫øt con ch∆∞a ƒë·ªß 18 tu·ªïi v√† kh√¥ng c√≥ b·∫±ng l√°i." },
      { level: 2, question: "H√†nh ƒë·ªông n√†o l√† b∆∞·ªõc ngo·∫∑t khi·∫øn s·ª± vi·ªác t·ª´ sai ph·∫°m c√° nh√¢n chuy·ªÉn th√†nh h·∫≠u qu·∫£ x√£ h·ªôi?", options: { A: "L·∫•y xe ƒëi ch∆°i ƒë√™m", B: "U·ªëng r∆∞·ª£u bia", C: "B·ªè ch·∫°y sau khi g√¢y tai n·∫°n", D: "Ch·ªü qu√° s·ªë ng∆∞·ªùi quy ƒë·ªãnh" }, correct: "C", explanation: "üí• B·ªé CH·∫†Y BI·∫æN TAI N·∫†N TH√ÄNH T·ªòI √ÅC! Th∆∞ ƒë√£ ƒë√¢m v√†o ng∆∞·ªùi ph·ª• n·ªØ khi v∆∞·ª£t ƒë√®n ƒë·ªè r·ªìi b·ªè ch·∫°y - ƒë√¢y l√† h√†nh vi vi ph·∫°m nghi√™m tr·ªçng ph√°p lu·∫≠t." },
      { level: 3, question: "Th√¥ng ƒëi·ªáp xuy√™n su·ªët k·ªãch b·∫£n v·ªÅ ATGT h·ªçc ƒë∆∞·ªùng l√† g√¨?", options: { A: "H·ªçc sinh thi·∫øu ki·∫øn th·ª©c", B: "C·∫ßn tƒÉng c∆∞·ªùng x·ª≠ ph·∫°t n·∫∑ng", C: "√ù th·ª©c ATGT ch·ªãu chi ph·ªëi t·ª´ Gia ƒë√¨nh - Nh√† tr∆∞·ªùng - X√£ h·ªôi", D: "Tai n·∫°n l√† ƒëi·ªÅu kh√≥ tr√°nh kh·ªèi" }, correct: "C", explanation: "üéì TAM GI√ÅC TR√ÅCH NHI·ªÜM! An to√†n giao th√¥ng h·ªçc ƒë∆∞·ªùng l√† tr√°ch nhi·ªám chung c·ªßa gia ƒë√¨nh ‚Äì nh√† tr∆∞·ªùng ‚Äì x√£ h·ªôi. C·∫ßn s·ª± ph·ªëi h·ª£p ƒë·ªÉ gi√°o d·ª•c h·ªçc sinh." },
      { level: 4, question: "√ù nghƒ©a quan tr·ªçng nh·∫•t c·ªßa vi·ªác x·ª≠ ph·∫°t nghi√™m minh h·ªçc sinh vi ph·∫°m l√† g√¨?", options: { A: "L√†m h·ªçc sinh s·ª£ h√£i", B: "H√¨nh th√†nh √Ω th·ª©c t·ª± gi√°c l√¢u d√†i", C: "Gi·∫£m vi·ªác cho nh√† tr∆∞·ªùng", D: "Th·ªÉ hi·ªán quy·ªÅn l·ª±c ph√°p lu·∫≠t" }, correct: "B", explanation: "üìö X·ª¨ PH·∫†T ƒê·ªÇ GI√ÅO D·ª§C! M·ª•c ƒë√≠ch c·ªßa x·ª≠ ph·∫°t kh√¥ng ph·∫£i tr·ª´ng tr·ªã m√† l√† gi√°o d·ª•c, gi√∫p h·ªçc sinh nh·∫≠n th·ª©c ƒë√∫ng ƒë·∫Øn v√† h√¨nh th√†nh √Ω th·ª©c t·ª± gi√°c ch·∫•p h√†nh lu·∫≠t giao th√¥ng." },
      { level: 5, question: "N·∫øu nh√† tr∆∞·ªùng tuy√™n truy·ªÅn t·ªët, nh∆∞ng gia ƒë√¨nh v·∫´n giao xe cho con ch∆∞a ƒë·ªß tu·ªïi th√¨ ƒëi·ªÅu g√¨ s·∫Ω x·∫£y ra?", options: { A: "√ù th·ª©c h·ªçc sinh v·∫´n t·ªët l√™n", B: "H·ªçc sinh ch·ªâ ch·∫•p h√†nh ·ªü tr∆∞·ªùng, d·ªÖ t√°i ph·∫°m ngo√†i x√£ h·ªôi", C: "Tai n·∫°n s·∫Ω gi·∫£m ƒë√°ng k·ªÉ", D: "H·ªçc sinh s·∫Ω t·ª± ƒë·ªông ngoan h∆°n" }, correct: "B", explanation: "üîÑ R·ªêI LO·∫†N GI√Å TR·ªä! Khi gia ƒë√¨nh v√† nh√† tr∆∞·ªùng kh√¥ng th·ªëng nh·∫•t, h·ªçc sinh s·∫Ω b·ªã m√¢u thu·∫´n gi√° tr·ªã - ngoan ·ªü tr∆∞·ªùng nh∆∞ng vi ph·∫°m ngo√†i x√£ h·ªôi." },
      { level: 6, question: "Thay ƒë·ªïi y·∫øu t·ªë then ch·ªët n√†o ƒë·ªÉ ngƒÉn ch·∫∑n TO√ÄN B·ªò chu·ªói h·∫≠u qu·∫£ trong k·ªãch b·∫£n?", options: { A: "Th∆∞ kh√¥ng ƒëi h√°t karaoke", B: "B·∫°n b√® kh√¥ng r·ªß ƒëi ch∆°i ƒë√™m", C: "Gia ƒë√¨nh KH√îNG mua xe m√°y cho Th∆∞", D: "CSGT tu·∫ßn tra g·∫Øt gao h∆°n" }, correct: "C", explanation: "üõ°Ô∏è CH·∫∂N T·ª™ G·ªêC! N·∫øu b·ªë m·∫π kh√¥ng mua xe Exciter cho Th∆∞ khi ch∆∞a ƒë·ªß tu·ªïi v√† b·∫±ng l√°i, th√¨ to√†n b·ªô chu·ªói s·ª± ki·ªán bi k·ªãch s·∫Ω kh√¥ng x·∫£y ra." },
      { level: 7, question: "C√°ch gi·∫£i quy·∫øt nh√¢n vƒÉn v√† hi·ªáu qu·∫£ nh·∫•t cho tr∆∞·ªùng h·ª£p Huy·ªÅn Th∆∞ l√† g√¨?", options: { A: "B·ªè qua v√¨ c√≤n nh·ªè tu·ªïi", B: "Ph·∫°t nghi√™m minh nh∆∞ng t·∫°o c∆° h·ªôi s·ª≠a sai", C: "Ph·∫°t n·∫∑ng nh·∫•t c√≥ th·ªÉ", D: "X·ª≠ nh·∫π ƒë·ªÉ kh√¥ng ·∫£nh h∆∞·ªüng t∆∞∆°ng lai" }, correct: "B", explanation: "‚öñÔ∏è NGHI√äM MINH NH∆ØNG NH√ÇN VƒÇN! ƒê√≥ l√† b√†i h·ªçc m√† sau n√†y em c·∫ßn ph·∫£i ghi nh·ªõ. X·ª≠ ph·∫°t ƒë√∫ng lu·∫≠t nh∆∞ng v·∫´n t·∫°o c∆° h·ªôi cho h·ªçc sinh s·ª≠a sai, h·ªçc t·∫≠p v√† tr·ªü th√†nh ng∆∞·ªùi t·ªët." }
    ];

    // Wheel items
    const wheelItems = [
      { text: "üåø RAU M√Å", type: "real", icon: "üåø", color: "#2ecc71" },
      { text: "üåØ NEM CHUA", type: "real", icon: "üåØ", color: "#e74c3c" },
      { text: "üçó KH√î G√Ä", type: "real", icon: "üçó", color: "#3498db" },
      { text: "üç¨ KEÃ£O CON", type: "real", icon: "üç¨", color: "#9b59b6" },
      { text: "üíé 1 T·ªà", type: "fake", icon: "üíé", color: "#f39c12" },
      { text: "üê∑ X√öC X√çCH HEO CAO BƒÇÃÄNG", type: "real", icon: "üê∑", color: "#1abc9c" },
    ];

    /* ========== GAME STATE ========== */
    let currentLevel = 0;
    let score = 0;
    let phase = "start";
    let countdownTimer = null;
    let wheelRotation = 0;

    /* ========== AUDIO MANAGER ========== */
    const AudioManager = {
      intro: document.getElementById('introMusic'),
      startEngine: document.getElementById('startEngineMusic'),
      bg: document.getElementById('bgMusic'),
      spin: document.getElementById('spinMusic'),
      correct: document.getElementById('correctMusic'),
      wrong: document.getElementById('wrongMusic'),
      
      playIntro() {
        this.stopAll();
        this.intro.volume = 0.4;
        this.intro.currentTime = 0;
        this.intro.play().catch(e => console.log("Audio blocked:", e));
      },
      
      playStartEngine() {
        this.intro.pause();
        this.startEngine.volume = 0.6;
        this.startEngine.currentTime = 0;
        this.startEngine.play().catch(e => console.log("Audio blocked:", e));
        
        // After engine sound, play bg music
        setTimeout(() => {
          this.playBg();
        }, 2000);
      },
      
      playBg() {
        this.bg.volume = 0.3;
        this.bg.currentTime = 0;
        this.bg.play().catch(e => console.log("Audio blocked:", e));
      },
      
      playSpin() {
        this.spin.volume = 0.5;
        this.spin.currentTime = 0;
        this.spin.play().catch(e => console.log("Audio blocked:", e));
      },
      
      stopSpin() {
        this.spin.pause();
        this.spin.currentTime = 0;
      },
      
      playCorrect() {
        this.correct.volume = 0.6;
        this.correct.currentTime = 0;
        this.correct.play().catch(e => console.log("Audio blocked:", e));
      },
      
      playWrong() {
        this.wrong.volume = 0.6;
        this.wrong.currentTime = 0;
        this.wrong.play().catch(e => console.log("Audio blocked:", e));
      },
      
      stopAll() {
        this.intro.pause();
        this.startEngine.pause();
        this.bg.pause();
        this.spin.pause();
        this.correct.pause();
        this.wrong.pause();
      }
    };

    /* ========== INIT ========== */
    function init() {
      initWheel();
      initCityBackground();
      initSpeedLines();
      
      // Play intro music when page loads
      document.addEventListener('click', function initAudio() {
        AudioManager.playIntro();
        document.removeEventListener('click', initAudio);
      }, { once: true });
      
      // Skip intro button
      document.getElementById('skipIntro').addEventListener('click', () => {
        AudioManager.playIntro();
        document.getElementById('cinematicIntro').style.display = 'none';
        document.getElementById('startScreen').style.display = 'flex';
      });
    }

    function initWheel() {
      const segmentsContainer = document.getElementById('wheelSegments');
      const labelsContainer = document.getElementById('wheelLabels');
      
      segmentsContainer.innerHTML = '';
      labelsContainer.innerHTML = '';
      
      const numSegments = wheelItems.length;
      const segAngle = 360 / numSegments;
      
      // Create SVG segments for perfect circle
      wheelItems.forEach((item, index) => {
        const startAngle = index * segAngle - 90; // Start from top
        const endAngle = startAngle + segAngle;
        
        const startRad = (startAngle * Math.PI) / 180;
        const endRad = (endAngle * Math.PI) / 180;
        
        const x1 = 100 + 100 * Math.cos(startRad);
        const y1 = 100 + 100 * Math.sin(startRad);
        const x2 = 100 + 100 * Math.cos(endRad);
        const y2 = 100 + 100 * Math.sin(endRad);
        
        const largeArc = segAngle > 180 ? 1 : 0;
        
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', `M100,100 L${x1},${y1} A100,100 0 ${largeArc},1 ${x2},${y2} Z`);
        path.setAttribute('fill', item.color);
        path.setAttribute('stroke', '#fff');
        path.setAttribute('stroke-width', '1');
        segmentsContainer.appendChild(path);
        
        // Create label
        const label = document.createElement('div');
        label.className = 'segment-label';
        label.textContent = item.text;
        
        // Position label in center of segment
        const midAngle = startAngle + segAngle / 2 + 90;
        label.style.transform = `rotate(${midAngle}deg) translateY(-50%)`;
        labelsContainer.appendChild(label);
      });
    }

    function initCityBackground() {
      const cityBg = document.getElementById('cityBg');
      for (let i = 0; i < 15; i++) {
        const building = document.createElement('div');
        building.className = 'city-building';
        building.style.left = (i * 7) + '%';
        building.style.width = (40 + Math.random() * 60) + 'px';
        building.style.height = (80 + Math.random() * 150) + 'px';
        cityBg.appendChild(building);
      }
    }

    function initSpeedLines() {
      const container = document.getElementById('speedLines');
      for (let i = 0; i < 20; i++) {
        const line = document.createElement('div');
        line.className = 'speed-line';
        line.style.left = Math.random() * 100 + '%';
        line.style.animationDelay = Math.random() * 0.5 + 's';
        line.style.height = (50 + Math.random() * 100) + 'px';
        container.appendChild(line);
      }
    }

    /* ========== GAME FLOW ========== */
    document.getElementById('startButton').addEventListener('click', () => {
      const name = document.getElementById('playerNameInput').value.trim();
      if (!name) { alert("Vui l√≤ng nh·∫≠p t√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu!"); return; }
      
      // Play engine start sound
      AudioManager.playStartEngine();
      
      document.getElementById('startScreen').style.display = 'none';
      document.getElementById('racingScreen').style.display = 'block';
      currentLevel = 0; score = 0;
      startLevel();
    });

    function startLevel() {
      if (currentLevel >= questions.length) { showResults(); return; }
      const q = questions[currentLevel];
      
      document.getElementById('levelDisplay').textContent = `LEVEL ${q.level}/7`;
      document.getElementById('scoreDisplay').textContent = `üíé ƒêI·ªÇM: ${score}`;
      
      document.getElementById('reward-message-box').classList.remove('active');
      document.getElementById('reward-container').innerHTML = '';

      // Reset scene
      const bike = document.getElementById('bike');
      bike.className = 'bike';
      document.querySelectorAll('.obstacle').forEach(o => o.style.display = 'none');
      document.getElementById('explosion').className = 'explosion-container';
      
      // Slow motion effect
      document.getElementById('road').classList.add('slow-motion');
      document.querySelectorAll('.lane-line').forEach(l => l.classList.add('slow-motion'));

      document.getElementById('questionPanel').style.display = 'block';
      document.getElementById('laneChoices').style.display = 'none';
      document.getElementById('explanationPanel').style.display = 'none';
      
      document.getElementById('questionText').textContent = q.question;
      document.getElementById('answerA').textContent = q.options.A;
      document.getElementById('answerB').textContent = q.options.B;
      document.getElementById('answerC').textContent = q.options.C;
      document.getElementById('answerD').textContent = q.options.D;

      startCountdown(10, () => {
        document.getElementById('questionPanel').style.display = 'none';
        document.getElementById('laneChoices').style.display = 'flex';
        document.getElementById('road').classList.remove('slow-motion');
        document.querySelectorAll('.lane-line').forEach(l => l.classList.remove('slow-motion'));
        document.querySelectorAll('.lane-choice').forEach(l => {
          l.classList.remove('correct', 'incorrect');
          l.style.pointerEvents = 'auto';
        });
        phase = "choosing";
      });
    }

    function startCountdown(seconds, onComplete) {
      let timeLeft = seconds;
      const el = document.getElementById('countdown');
      el.textContent = timeLeft;
      if(countdownTimer) clearInterval(countdownTimer);
      countdownTimer = setInterval(() => {
        timeLeft--;
        el.textContent = timeLeft;
        if (timeLeft <= 3) el.style.color = '#ff0000';
        else el.style.color = '#ff0000';
        if (timeLeft <= 0) {
          clearInterval(countdownTimer);
          if (onComplete) onComplete();
        }
      }, 1000);
    }

    /* ========== ANSWER HANDLING ========== */
    document.querySelectorAll('.lane-choice').forEach(laneBtn => {
      laneBtn.addEventListener('click', () => {
        if (phase !== "choosing") return;
        phase = "answered";
        if (countdownTimer) clearInterval(countdownTimer);

        const selected = laneBtn.dataset.lane;
        const q = questions[currentLevel];
        const isCorrect = (selected === q.correct);

        document.querySelectorAll('.lane-choice').forEach(l => l.style.pointerEvents = 'none');

        // Show obstacles on wrong lanes
        const lanes = ['A', 'B', 'C', 'D'];
        lanes.forEach(lane => {
          if (lane !== q.correct) {
            const rock = document.getElementById(`rock-${lane}`);
            rock.classList.add(`lane-${lane.toLowerCase()}`);
            rock.style.display = 'block';
          }
        });

        // Move bike
        const bike = document.getElementById('bike');
        bike.classList.add(`lane-${selected.toLowerCase()}`);

        setTimeout(() => {
          document.querySelectorAll('.lane-choice').forEach(l => {
            if (l.dataset.lane === q.correct) l.classList.add('correct');
            else if (l.dataset.lane === selected && !isCorrect) l.classList.add('incorrect');
          });

          if (isCorrect) {
            AudioManager.playCorrect();
            score += 100;
            document.getElementById('scoreDisplay').textContent = `üíé ƒêI·ªÇM: ${score}`;
            triggerConfetti();
            
            setTimeout(() => {
              openLuckyWheel(q.explanation);
            }, 500);
          } else {
            AudioManager.playWrong();
            bike.classList.add('crashed');
            triggerFlash();
            
            const explosion = document.getElementById('explosion');
            explosion.classList.add(`lane-${selected.toLowerCase()}`);
            explosion.classList.add('active');
            
            setTimeout(() => {
              showFlashback(() => { showExplanation(false, q.explanation); });
            }, 1200);
          }
        }, 500);
      });
    });

    /* ========== LUCKY WHEEL ========== */
    function openLuckyWheel(explanationText) {
      const overlay = document.getElementById('wheelOverlay');
      const spinBtn = document.getElementById('spinBtn');
      overlay.style.display = 'flex';
      spinBtn.disabled = false;
      spinBtn.textContent = "üé≤ QUAY NGAY!";

      spinBtn.onclick = () => {
        spinBtn.disabled = true;
        spinBtn.textContent = "ƒêANG QUAY...";
        
        // Play spin music
        AudioManager.playSpin();
        
        // Choose random winning item
        const realItems = wheelItems.filter(item => item.type === "real");
        const winningItem = realItems[Math.floor(Math.random() * realItems.length)];
        const targetIndex = wheelItems.indexOf(winningItem);
        
        const segmentAngle = 360 / wheelItems.length;
        const stopAngle = -(targetIndex * segmentAngle + segmentAngle/2);
        const extraSpins = 360 * 8;
        const jitter = Math.floor(Math.random() * 30) - 15;
        
        let currentMod = wheelRotation % 360;
        let distToTarget = stopAngle - currentMod;
        while (distToTarget < 0) { distToTarget += 360; }
        
        const totalRotation = wheelRotation + extraSpins + distToTarget + jitter;
        
        const wheel = document.getElementById('luckyWheel');
        wheel.style.transform = `rotate(${totalRotation}deg)`;
        wheelRotation = totalRotation;

        setTimeout(() => {
          AudioManager.stopSpin();
          AudioManager.playCorrect();
          overlay.style.display = 'none';
          triggerReward(winningItem.text, winningItem.icon);
          setTimeout(() => {
            showExplanation(true, explanationText);
          }, 2500);
        }, 5000);
      };
    }

    function triggerReward(itemName, icon) {
      const msgBox = document.getElementById('reward-message-box');
      document.getElementById('reward-name').textContent = itemName;
      msgBox.classList.add('active');

      const container = document.getElementById('reward-container');
      container.innerHTML = '';
      for (let i = 0; i < 30; i++) {
        const item = document.createElement('div');
        item.classList.add('reward-item');
        item.textContent = icon;
        item.style.left = Math.random() * 100 + "%";
        item.style.animationDuration = (2 + Math.random() * 2) + "s";
        item.style.animationDelay = Math.random() * 0.5 + "s";
        item.style.fontSize = (2 + Math.random() * 2) + "rem";
        container.appendChild(item);
      }
    }

    /* ========== EFFECTS ========== */
    function triggerFlash() {
      const flash = document.getElementById('screenFlash');
      flash.classList.remove('active');
      void flash.offsetWidth;
      flash.classList.add('active');
    }

    function triggerConfetti() {
      const container = document.getElementById('confetti');
      container.innerHTML = '';
      container.classList.add('active');
      
      const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
      for (let i = 0; i < 50; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.left = Math.random() * 100 + '%';
        piece.style.background = colors[Math.floor(Math.random() * colors.length)];
        piece.style.animationDelay = Math.random() * 0.5 + 's';
        container.appendChild(piece);
      }
      
      setTimeout(() => container.classList.remove('active'), 3000);
    }

    function showFlashback(callback) {
      const fb = document.getElementById('flashbackOverlay');
      fb.style.display = 'flex';
      setTimeout(() => { fb.style.display = 'none'; if (callback) callback(); }, 4000);
    }

    function showExplanation(isCorrect, text) {
      document.getElementById('laneChoices').style.display = 'none';
      const panel = document.getElementById('explanationPanel');
      const title = document.getElementById('explanationTitle');
      panel.style.display = 'block';
      title.textContent = isCorrect ? "‚úÖ CH√çNH X√ÅC! AN TO√ÄN TUY·ªÜT ƒê·ªêI!" : "‚ùå TAI N·∫†N KINH HO√ÄNG!";
      title.className = isCorrect ? "explanation-title correct" : "explanation-title incorrect";
      document.getElementById('explanationText').textContent = text;
    }

    document.getElementById('nextButton').addEventListener('click', () => {
      currentLevel++;
      startLevel();
    });

    function showResults() {
      document.getElementById('racingScreen').style.display = 'none';
      document.getElementById('resultsScreen').style.display = 'flex';
      triggerConfetti();
      
      let msg = "";
      if (score >= 600) msg = "üèÜ XU·∫§T S·∫ÆC! B·∫°n l√† Chuy√™n gia An to√†n Giao th√¥ng! H√£y lan t·ªèa th√¥ng ƒëi·ªáp n√†y ƒë·∫øn m·ªçi ng∆∞·ªùi!";
      else if (score >= 400) msg = "üëç KH√Å T·ªêT! B·∫°n ƒë√£ hi·ªÉu ph·∫ßn l·ªõn ki·∫øn th·ª©c ATGT. H√£y ti·∫øp t·ª•c h·ªçc h·ªèi!";
      else msg = "üìö C·∫¶N C·ªê G·∫ÆNG! H√£y nh·ªõ: 'M·ªôt gi√¢y b·∫•t c·∫©n tr√™n ƒë∆∞·ªùng c√≥ th·ªÉ ƒë·ªïi l·∫•y c·∫£ ƒë·ªùi h·ªëi h·∫≠n.'";
      
      document.getElementById('finalScore').textContent = `üíé T·ªîNG ƒêI·ªÇM: ${score}`;
      document.getElementById('resultsMessage').textContent = msg;
    }

    /* ========== START ========== */
    init();
  </script>
</body>
</html>
