<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ƒê∆∞·ªùng ƒêua Ch√¢n L√Ω - The Truth Highway</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
  
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Orbitron', 'Rajdhani', monospace;
      overflow: hidden;
      background: #000;
    }

    html, body, .game-wrapper {
      height: 100%;
      width: 100%;
    }

    .game-wrapper {
      background: linear-gradient(180deg, #0a0e27 0%, #1a1a2e 50%, #0f3460 100%);
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }

    /* Start Screen */
    .start-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      padding: 2rem;
      text-align: center;
      position: relative;
      z-index: 10;
    }

    .neon-title {
      font-size: 4rem;
      font-weight: 900;
      color: #00ff41;
      text-shadow: 0 0 10px #00ff41, 0 0 20px #00ff41, 0 0 30px #00ff41;
      margin-bottom: 1rem;
      letter-spacing: 3px;
      animation: flicker 3s infinite alternate;
    }

    @keyframes flicker {
      0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { text-shadow: 0 0 10px #00ff41, 0 0 20px #00ff41; }
      20%, 24%, 55% { text-shadow: none; }
    }

    .highway-subtitle {
      font-size: 1.5rem;
      color: #00d9ff;
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 4px;
    }

    .story-intro {
      font-size: 1.1rem;
      color: #ffffff;
      max-width: 700px;
      line-height: 1.8;
      margin-bottom: 2rem;
      background: rgba(0, 0, 0, 0.5);
      padding: 1.5rem;
      border-radius: 15px;
      border: 2px solid #00ff41;
      font-family: 'Rajdhani', sans-serif;
    }

    .start-input {
      width: 100%;
      max-width: 450px;
      padding: 1.2rem 2rem;
      font-size: 1.2rem;
      border: 3px solid #00ff41;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: #00ff41;
      margin-bottom: 2rem;
      font-family: 'Orbitron', monospace;
      text-align: center;
      font-weight: 700;
    }

    .start-button {
      padding: 1.2rem 4rem;
      font-size: 1.4rem;
      font-weight: 900;
      background: linear-gradient(135deg, #ff0000 0%, #ff6b00 100%);
      color: white;
      border: 3px solid #ffff00;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
      text-transform: uppercase;
      letter-spacing: 2px;
      font-family: 'Orbitron', monospace;
    }

    .start-button:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 0 40px rgba(255, 0, 0, 0.8);
    }

    /* Racing Screen */
    .racing-screen {
      display: none;
      height: 100%;
      position: relative;
      overflow: hidden;
    }

    /* Highway Road */
    .highway-container {
      height: 100%;
      width: 100%;
      position: relative;
      background: #2c2c2c;
      perspective: 1000px;
      overflow: hidden;
    }

    .road {
      position: absolute;
      bottom: 0; left: 0; right: 0; height: 100%;
      background: repeating-linear-gradient(0deg, #1a1a1a 0px, #1a1a1a 50px, #2c2c2c 50px, #2c2c2c 100px);
      animation: roadScroll 0.5s linear infinite; /* Normal speed */
      transform: rotateX(20deg);
      transform-origin: bottom;
    }

    .road.slow-motion {
      animation: roadScroll 4s linear infinite; /* Bullet time */
    }

    @keyframes roadScroll {
      from { background-position: 0 0; }
      to { background-position: 0 100px; }
    }

    /* Lane Lines */
    .lane-lines {
      position: absolute; top: 0; bottom: 0; left: 0; right: 0;
      display: flex; justify-content: space-around; padding: 0 10%;
    }

    .lane-line {
      width: 4px; height: 100%;
      background: repeating-linear-gradient(0deg, #ffff00 0px, #ffff00 40px, transparent 40px, transparent 80px);
      animation: laneScroll 0.5s linear infinite;
    }

    .lane-line.slow-motion { animation: laneScroll 4s linear infinite; }

    @keyframes laneScroll {
      from { background-position: 0 0; }
      to { background-position: 0 80px; }
    }

    /* --- OBSTACLES (ƒê√Å) --- */
    .obstacle {
      position: absolute;
      bottom: 40%;
      transform: translateX(-50%);
      z-index: 95;
      display: none;
    }
    
    .rock-graphic {
      width: 80px;
      height: 60px;
      background: #7f8c8d;
      border-radius: 40% 60% 60% 40% / 60% 30% 70% 40%;
      border: 3px solid #2c3e50;
      box-shadow: inset -10px -10px 0 rgba(0,0,0,0.3), 0 10px 20px rgba(0,0,0,0.8);
      position: relative;
    }
    .rock-graphic::after {
      content: '';
      position: absolute;
      top: 15px; left: 20px;
      width: 15px; height: 8px;
      background: rgba(0,0,0,0.2);
      border-radius: 50%;
    }

    .obstacle.lane-a { left: 15%; }
    .obstacle.lane-b { left: 38%; }
    .obstacle.lane-c { left: 62%; }
    .obstacle.lane-d { left: 85%; }

    /* --- EXPLOSION EFFECT --- */
    .explosion-container {
      position: absolute;
      bottom: 40%;
      transform: translate(-50%, 50%);
      z-index: 150;
      display: none;
      pointer-events: none;
    }

    .explosion-container.active { display: block; }

    .explosion-core {
      width: 20px; height: 20px;
      border-radius: 50%;
      background: radial-gradient(circle, #ffeb3b 0%, #ff9800 40%, #f44336 70%, transparent 100%);
      animation: explosionAnim 0.8s ease-out forwards;
      box-shadow: 0 0 20px #ff9800;
    }

    .explosion-text {
      position: absolute;
      top: -60px; left: 50%;
      transform: translateX(-50%) scale(0);
      color: #ffff00;
      font-weight: 900;
      font-size: 3rem;
      font-style: italic;
      text-shadow: 4px 4px 0 #ff0000;
      animation: textPop 0.6s ease-out forwards;
      white-space: nowrap;
    }

    @keyframes explosionAnim {
      0% { transform: scale(1); opacity: 1; }
      30% { transform: scale(8); opacity: 1; }
      100% { transform: scale(12); opacity: 0; }
    }

    .explosion-container.lane-a { left: 15%; }
    .explosion-container.lane-b { left: 38%; }
    .explosion-container.lane-c { left: 62%; }
    .explosion-container.lane-d { left: 85%; }

    /* --- REWARD EFFECT (RAU M√Å / NEM CHUA) --- */
    .reward-container {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none;
      z-index: 500;
      overflow: hidden;
    }
    
    .reward-item {
      position: absolute;
      bottom: -50px;
      font-size: 3rem;
      animation: floatUp 3s ease-out forwards;
    }

    @keyframes floatUp {
      0% { transform: translateY(0) rotate(0deg) scale(0.5); opacity: 0; }
      10% { opacity: 1; }
      100% { transform: translateY(-100vh) rotate(360deg) scale(1.2); opacity: 0; }
    }

    .reward-message-box {
      position: absolute;
      top: 30%; left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: linear-gradient(135deg, #00ff41 0%, #008f24 100%);
      padding: 1rem 3rem;
      border: 3px solid #fff;
      border-radius: 50px;
      text-align: center;
      z-index: 600;
      box-shadow: 0 0 30px rgba(0, 255, 65, 0.8);
      display: none;
    }
    
    .reward-message-box.active { animation: popInMsg 3s forwards; display: block; }

    @keyframes popInMsg {
      0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
      10% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
      20% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
    }

    .reward-title { font-size: 1.5rem; color: #fff; font-weight: bold; margin-bottom: 5px; }
    .reward-name { font-size: 2.5rem; color: #ffff00; font-weight: 900; text-transform: uppercase; text-shadow: 2px 2px 0 #000; }

    /* Exciter Bike */
    .bike {
      position: absolute;
      bottom: 15%;
      left: 50%;
      transform: translateX(-50%);
      font-size: 5rem;
      z-index: 100;
      transition: left 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.5));
    }

    .bike.crashed {
      animation: shake 0.5s ease-in-out;
      filter: sepia(1) hue-rotate(-50deg) saturate(5) brightness(0.6);
    }

    @keyframes shake {
      0% { transform: translateX(-50%) rotate(0deg); }
      10%, 90% { transform: translateX(-55%) rotate(-5deg); }
      20%, 80% { transform: translateX(-45%) rotate(5deg); }
      30%, 50%, 70% { transform: translateX(-55%) rotate(-5deg); }
      40%, 60% { transform: translateX(-45%) rotate(5deg); }
      100% { transform: translateX(-50%) rotate(0deg); }
    }

    .bike.lane-a { left: 15%; }
    .bike.lane-b { left: 38%; }
    .bike.lane-c { left: 62%; }
    .bike.lane-d { left: 85%; }

    /* HUD */
    .hud {
      position: absolute; top: 0; left: 0; right: 0; padding: 2rem;
      display: flex; justify-content: space-between;
      z-index: 200; pointer-events: none;
    }

    .hud-item {
      background: rgba(0, 0, 0, 0.8);
      padding: 1rem 2rem;
      border: 2px solid #00ff41;
      font-size: 1.3rem;
      color: #00ff41;
      font-weight: 700;
      text-shadow: 0 0 10px #00ff41;
    }

    /* Question Panel */
    .question-panel {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.95);
      padding: 2rem;
      border: 4px solid #00ff41;
      width: 800px; max-width: 90%;
      z-index: 300;
      display: none;
      box-shadow: 0 0 40px rgba(0, 255, 65, 0.6);
      text-align: center;
    }

    .bullet-time-text {
      color: #00d9ff; font-size: 1.2rem;
      text-transform: uppercase; letter-spacing: 3px;
      margin-bottom: 1rem; animation: pulse 1s infinite;
    }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

    .question-text { font-size: 1.5rem; color: #fff; margin-bottom: 2rem; line-height: 1.6; }
    .countdown { font-size: 3rem; color: #ff0000; font-weight: 900; }

    /* Lane Choices */
    .lane-choices {
      position: absolute; bottom: 0; left: 0; right: 0; height: 30%;
      display: flex; z-index: 250; pointer-events: all;
    }

    .lane-choice {
      flex: 1;
      background: linear-gradient(180deg, rgba(0, 255, 65, 0.1) 0%, rgba(0, 255, 65, 0.3) 100%);
      border: 1px dashed rgba(0, 255, 65, 0.3);
      cursor: pointer;
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      padding: 1rem;
      transition: 0.3s;
    }

    .lane-choice:hover { background: rgba(0, 255, 65, 0.4); border: 2px solid #00ff41; }
    .lane-label { font-size: 2.5rem; font-weight: 900; color: #00ff41; text-shadow: 0 0 15px #00ff41; }
    .lane-answer { color: #fff; text-align: center; margin-top: 10px; font-family: 'Rajdhani'; font-weight: bold;}

    .lane-choice.correct { background: rgba(0, 255, 0, 0.6); border-color: #00ff00; }
    .lane-choice.incorrect { background: rgba(255, 0, 0, 0.6); border-color: #ff0000; }

    @keyframes textPop {
      0% { transform: translateX(-50%) scale(0) rotate(-10deg); opacity: 0; }
      50% { transform: translateX(-50%) scale(1.5) rotate(10deg); opacity: 1; }
      100% { transform: translateX(-50%) scale(1) rotate(0deg); opacity: 0; top: -100px; }
    }

    /* Flashback Overlay */
    .flashback-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.98);
      z-index: 400;
      display: none;
      flex-direction: column;
      justify-content: center; align-items: center;
    }

    .flashback-title { font-size: 3rem; color: #ff0000; text-transform: uppercase; animation: glitch 0.2s infinite; }
    @keyframes glitch { 0% { transform: translate(0); } 20% { transform: translate(-2px, 2px); } 40% { transform: translate(2px, -2px); } 100% { transform: translate(0); } }

    .flashback-scene { font-size: 6rem; margin: 20px 0; }
    .flashback-text { color: #fff; max-width: 600px; text-align: center; font-size: 1.5rem; line-height: 1.6; border: 2px solid red; padding: 20px; }

    /* Explanation Panel */
    .explanation-panel {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #000; border: 4px solid #00d9ff;
      padding: 2rem; width: 800px; max-width: 90%;
      z-index: 350; display: none; text-align: center;
    }
    .explanation-title { font-size: 2rem; margin-bottom: 1rem; font-weight: bold; }
    .explanation-title.correct { color: #00ff00; }
    .explanation-title.incorrect { color: #ff0000; }
    .explanation-text { color: #fff; font-size: 1.2rem; margin-bottom: 2rem; font-family: 'Rajdhani'; }

    .next-button {
      padding: 1rem 3rem; font-size: 1.2rem; background: #00ff41;
      border: none; cursor: pointer; font-weight: bold; text-transform: uppercase;
    }

    /* Results */
    .results-screen {
      display: none; flex-direction: column; align-items: center; justify-content: center;
      height: 100%; color: #fff;
    }
    .results-score { font-size: 3rem; color: #ffff00; margin: 20px 0; text-shadow: 0 0 20px #ffff00; }
    .results-message { font-size: 1.5rem; max-width: 600px; text-align: center; margin-bottom: 30px; }

  </style>
</head>
<body>
  <div class="game-wrapper">
    
    <!-- Start Screen -->
    <div class="start-screen" id="startScreen">
      <div class="neon-title">üèçÔ∏è ƒê∆Ø·ªúNG ƒêUA CH√ÇN L√ù</div>
      <div class="highway-subtitle">THE TRUTH HIGHWAY</div>
      <div class="story-intro">
        <p><strong>Nhi·ªám v·ª•:</strong> ƒêi·ªÅu khi·ªÉn xe Exciter ch·∫°y l·∫°i h√†nh tr√¨nh c·ªßa Huy·ªÅn Th∆∞.</p>
        <p><strong>Lu·∫≠t ch∆°i:</strong> Tr·∫£ l·ªùi ƒë√∫ng nh·∫≠n <strong>Rau M√° / Nem Chua</strong>. Tr·∫£ l·ªùi sai ƒë√¢m <strong>ƒê√° n·ªï xe</strong>!</p>
      </div>
      <input type="text" class="start-input" id="playerNameInput" placeholder="NH·∫¨P T√äN C·ª¶A B·∫†N..." maxlength="30">
      <button class="start-button" id="startButton">üöÄ KH·ªûI ƒê·ªòNG XE</button>
    </div>

    <!-- Racing Screen -->
    <div class="racing-screen" id="racingScreen">
      <!-- Road -->
      <div class="highway-container">
        <div class="road" id="road">
          <div class="lane-lines">
            <div class="lane-line"></div>
            <div class="lane-line"></div>
            <div class="lane-line"></div>
          </div>
        </div>

        <!-- Reward Container (N∆°i ch·ª©a rau m√° / nem chua bay) -->
        <div id="reward-container" class="reward-container"></div>
        
        <!-- Reward Message (Th√¥ng b√°o tr√∫ng th∆∞·ªüng) -->
        <div id="reward-message-box" class="reward-message-box">
          <div class="reward-title">CH√çNH X√ÅC! T·∫∂NG B·∫†N:</div>
          <div class="reward-name" id="reward-name">LY RAU M√Å</div>
        </div>

        <!-- Obstacles -->
        <div id="obstacles-container">
          <div class="obstacle" id="rock-A"><div class="rock-graphic"></div></div>
          <div class="obstacle" id="rock-B"><div class="rock-graphic"></div></div>
          <div class="obstacle" id="rock-C"><div class="rock-graphic"></div></div>
          <div class="obstacle" id="rock-D"><div class="rock-graphic"></div></div>
        </div>

        <!-- Explosion Effect -->
        <div id="explosion" class="explosion-container">
          <div class="explosion-core"></div>
          <div class="explosion-text">B√ôM!</div>
        </div>

        <!-- Bike -->
        <div class="bike" id="bike">üèçÔ∏è</div>
      </div>

      <!-- HUD -->
      <div class="hud">
        <div class="hud-item" id="levelDisplay">LEVEL 1/7</div>
        <div class="hud-item hud-score" id="scoreDisplay">ƒêI·ªÇM: 0</div>
      </div>

      <!-- Question Panel -->
      <div class="question-panel" id="questionPanel">
        <div class="bullet-time-text">‚è±Ô∏è BULLET TIME ACTIVATED ‚è±Ô∏è</div>
        <div class="question-text" id="questionText">N·ªôi dung c√¢u h·ªèi...</div>
        <div class="countdown" id="countdown">10</div>
      </div>

      <!-- Lane Choices -->
      <div class="lane-choices" id="laneChoices" style="display: none;">
        <div class="lane-choice" data-lane="A">
          <div class="lane-label">A</div>
          <div class="lane-answer" id="answerA"></div>
        </div>
        <div class="lane-choice" data-lane="B">
          <div class="lane-label">B</div>
          <div class="lane-answer" id="answerB"></div>
        </div>
        <div class="lane-choice" data-lane="C">
          <div class="lane-label">C</div>
          <div class="lane-answer" id="answerC"></div>
        </div>
        <div class="lane-choice" data-lane="D">
          <div class="lane-label">D</div>
          <div class="lane-answer" id="answerD"></div>
        </div>
      </div>

      <!-- Explanation Panel -->
      <div class="explanation-panel" id="explanationPanel">
        <div class="explanation-title" id="explanationTitle"></div>
        <div class="explanation-text" id="explanationText"></div>
        <button class="next-button" id="nextButton">TI·∫æP T·ª§C ‚ûú</button>
      </div>
    </div>

    <!-- Flashback Overlay -->
    <div class="flashback-overlay" id="flashbackOverlay">
      <div class="flashback-title">‚ö†Ô∏è XE N·ªî! FLASHBACK ‚ö†Ô∏è</div>
      <div class="flashback-scene">üî•üê∑üî•</div>
      <div class="flashback-text">
        Tai n·∫°n th·∫£m kh·ªëc ƒë√£ x·∫£y ra!<br>
        Kh√¥ng ch·ªâ h·ªèng xe, m√† c√≤n k√©o theo bao h·ªá l·ª•y ƒëau l√≤ng.
      </div>
    </div>

    <!-- Results Screen -->
    <div class="results-screen" id="resultsScreen">
      <div class="results-trophy">üèÜ</div>
      <div class="results-title">HO√ÄN TH√ÄNH!</div>
      <div class="results-score" id="finalScore"></div>
      <div class="results-message" id="resultsMessage"></div>
      <button class="restart-button" onclick="location.reload()">üîÑ CH∆†I L·∫†I</button>
    </div>

  </div>

  <script>
    /* D·ªÆ LI·ªÜU C√ÇU H·ªéI */
    const questions = [
      {
        level: 1,
        question: "Huy·ªÅn Th∆∞ l√† ng∆∞·ªùi vi ph·∫°m, nh∆∞ng y·∫øu t·ªë n√†o l√† 'nguy√™n nh√¢n g·ªëc' t·∫°o ƒëi·ªÅu ki·ªán cho sai ph·∫°m n√†y?",
        options: { A: "Th∆∞ thi·∫øu hi·ªÉu bi·∫øt lu·∫≠t", B: "B·∫°n b√® r·ªß r√™", C: "Gia ƒë√¨nh cho ph√©p ƒëi xe khi ch∆∞a ƒë·ªß tu·ªïi", D: "Qu·∫£n l√Ω l·ªèng l·∫ªo" },
        correct: "C",
        explanation: "üéØ G·ªêC R·ªÑ N·∫∞M ·ªû S·ª∞ NU√îNG CHI·ªÄU SAI L·∫¶M C·ª¶A PH·ª§ HUYNH!\nKhi gia ƒë√¨nh cho ph√©p con ch∆∞a ƒë·ªß tu·ªïi s·ª≠ d·ª•ng xe m√°y, ƒë√≥ ch√≠nh l√† ngu·ªìn g·ªëc c·ªßa m·ªçi vi ph·∫°m."
      },
      {
        level: 2,
        question: "H√†nh ƒë·ªông n√†o l√† b∆∞·ªõc ngo·∫∑t khi·∫øn s·ª± vi·ªác t·ª´ sai ph·∫°m c√° nh√¢n chuy·ªÉn th√†nh h·∫≠u qu·∫£ x√£ h·ªôi?",
        options: { A: "L·∫•y xe ƒëi", B: "Nh·∫≠u nh·∫πt", C: "B·ªè ch·∫°y sau khi g√¢y tai n·∫°n", D: "Ch·ªü qu√° s·ªë ng∆∞·ªùi" },
        correct: "C",
        explanation: "üí• B·ªé CH·∫†Y BI·∫æN TAI N·∫†N TH√ÄNH T·ªòI √ÅC!\nƒê√¢y l√† h√†nh ƒë·ªông v√¥ c·∫£m, bi·∫øn m·ªôt v·ª• tai n·∫°n d√¢n s·ª± th√†nh √°n h√¨nh s·ª±."
      },
      {
        level: 3,
        question: "Th√¥ng ƒëi·ªáp xuy√™n su·ªët k·ªãch b·∫£n v·ªÅ ATGT h·ªçc ƒë∆∞·ªùng l√† g√¨?",
        options: { A: "H·ªçc sinh thi·∫øu ki·∫øn th·ª©c", B: "C·∫ßn tƒÉng c∆∞·ªùng x·ª≠ ph·∫°t", C: "√ù th·ª©c ch·ªãu chi ph·ªëi t·ª´ Gia ƒë√¨nh - Nh√† tr∆∞·ªùng - X√£ h·ªôi", D: "Tai n·∫°n kh√≥ tr√°nh" },
        correct: "C",
        explanation: "üéì TAM GI√ÅC TR√ÅCH NHI·ªÜM!\nATGT c·∫ßn s·ª± ph·ªëi h·ª£p ch·∫∑t ch·∫Ω gi·ªØa Gia ƒë√¨nh (qu·∫£n l√Ω), Nh√† tr∆∞·ªùng (gi√°o d·ª•c) v√† X√£ h·ªôi (lu·∫≠t ph√°p)."
      },
      {
        level: 4,
        question: "√ù nghƒ©a quan tr·ªçng nh·∫•t c·ªßa vi·ªác x·ª≠ ph·∫°t nghi√™m minh h·ªçc sinh l√† g√¨?",
        options: { A: "L√†m h·ªçc sinh s·ª£", B: "H√¨nh th√†nh √Ω th·ª©c t·ª± gi√°c l√¢u d√†i", C: "Gi·∫£m vi·ªác cho tr∆∞·ªùng", D: "Th·ªÉ hi·ªán quy·ªÅn l·ª±c" },
        correct: "B",
        explanation: "üìö X·ª¨ PH·∫†T ƒê·ªÇ GI√ÅO D·ª§C!\nM·ª•c ti√™u l√† gi√∫p h·ªçc sinh nh·∫≠n th·ª©c h·∫≠u qu·∫£, t·ª´ ƒë√≥ h√¨nh th√†nh th√≥i quen tu√¢n th·ªß lu·∫≠t l·ªá su·ªët ƒë·ªùi."
      },
      {
        level: 5,
        question: "Nh√† tr∆∞·ªùng tuy√™n truy·ªÅn t·ªët, nh∆∞ng gia ƒë√¨nh v·∫´n giao xe cho con ch∆∞a ƒë·ªß tu·ªïi th√¨ sao?",
        options: { A: "√ù th·ª©c t·ªët l√™n", B: "Ch·ªâ ch·∫•p h√†nh ·ªü tr∆∞·ªùng, d·ªÖ t√°i ph·∫°m ngo√†i x√£ h·ªôi", C: "Tai n·∫°n gi·∫£m", D: "H·ªçc sinh t·ª± ngoan" },
        correct: "B",
        explanation: "üîÑ R·ªêI LO·∫†N GI√Å TR·ªä!\nH·ªçc sinh s·∫Ω b·ªã m√¢u thu·∫´n gi·ªØa l·ªùi th·∫ßy c√¥ d·∫°y v√† h√†nh ƒë·ªông c·ªßa b·ªë m·∫π, d·∫´n ƒë·∫øn nh·ªùn lu·∫≠t."
      },
      {
        level: 6,
        question: "Thay ƒë·ªïi y·∫øu t·ªë then ch·ªët n√†o ƒë·ªÉ ngƒÉn ch·∫∑n to√†n b·ªô chu·ªói h·∫≠u qu·∫£ trong k·ªãch b·∫£n?",
        options: { A: "Th∆∞ kh√¥ng u·ªëng r∆∞·ª£u", B: "B·∫°n kh√¥ng r·ªß", C: "Gia ƒë√¨nh KH√îNG cho ph√©p d√πng xe m√°y", D: "CSGT l√†m g·∫Øt" },
        correct: "C",
        explanation: "üõ°Ô∏è CH·∫∂N T·ª™ G·ªêC!\nN·∫øu kh√¥ng c√≥ xe m√°y, to√†n b·ªô chu·ªói s·ª± ki·ªán tai n·∫°n ph√≠a sau s·∫Ω KH√îNG bao gi·ªù x·∫£y ra."
      },
      {
        level: 7,
        question: "'ƒê√°nh ng∆∞·ªùi ch·∫°y ƒëi ch·ª© kh√¥ng ai ƒë√°nh ng∆∞·ªùi ch·∫°y l·∫°i' √°p d·ª•ng th·∫ø n√†o cho Huy·ªÅn Th∆∞?",
        options: { A: "B·ªè qua h·∫øt", B: "Ph·∫°t nghi√™m nh∆∞ng t·∫°o c∆° h·ªôi s·ª≠a sai", C: "T√¨nh c·∫£m tr√™n lu·∫≠t", D: "X·ª≠ nh·∫π tay" },
        correct: "B",
        explanation: "‚öñÔ∏è NGHI√äM MINH NH∆ØNG NH√ÇN VƒÇN!\nC·∫ßn x·ª≠ ph·∫°t ƒë·ªÉ rƒÉn ƒëe, nh∆∞ng c≈©ng m·ªü ƒë∆∞·ªùng ƒë·ªÉ em s·ª≠a ƒë·ªïi v√† tr·ªü th√†nh ng∆∞·ªùi t·ªët."
      }
    ];

    /* LOGIC GAME */
    let currentLevel = 0;
    let score = 0;
    let phase = "start"; 
    let countdownTimer = null;

    document.getElementById('startButton').addEventListener('click', () => {
      const name = document.getElementById('playerNameInput').value.trim();
      if (!name) { alert("Vui l√≤ng nh·∫≠p t√™n!"); return; }
      
      document.getElementById('startScreen').style.display = 'none';
      document.getElementById('racingScreen').style.display = 'block';
      
      currentLevel = 0;
      score = 0;
      startLevel();
    });

    function startLevel() {
      if (currentLevel >= questions.length) {
        showResults();
        return;
      }

      const q = questions[currentLevel];
      
      document.getElementById('levelDisplay').textContent = `LEVEL ${q.level}/7`;
      document.getElementById('scoreDisplay').textContent = `ƒêI·ªÇM: ${score}`;

      // Reset
      const bike = document.getElementById('bike');
      bike.className = 'bike'; 
      document.querySelectorAll('.obstacle').forEach(o => o.style.display = 'none');
      document.getElementById('explosion').className = 'explosion-container';
      document.getElementById('reward-message-box').classList.remove('active');
      
      document.getElementById('road').classList.add('slow-motion');
      document.querySelectorAll('.lane-line').forEach(l => l.classList.add('slow-motion'));

      document.getElementById('questionPanel').style.display = 'block';
      document.getElementById('laneChoices').style.display = 'none';
      document.getElementById('explanationPanel').style.display = 'none';
      
      document.getElementById('questionText').textContent = q.question;

      document.getElementById('answerA').textContent = q.options.A;
      document.getElementById('answerB').textContent = q.options.B;
      document.getElementById('answerC').textContent = q.options.C;
      document.getElementById('answerD').textContent = q.options.D;

      startCountdown(10, () => {
        document.getElementById('questionPanel').style.display = 'none';
        document.getElementById('laneChoices').style.display = 'flex';
        
        document.getElementById('road').classList.remove('slow-motion');
        document.querySelectorAll('.lane-line').forEach(l => l.classList.remove('slow-motion'));

        document.querySelectorAll('.lane-choice').forEach(l => {
          l.classList.remove('correct', 'incorrect');
          l.style.pointerEvents = 'auto';
        });

        phase = "choosing";
      });
    }

    function startCountdown(seconds, onComplete) {
      let timeLeft = seconds;
      const el = document.getElementById('countdown');
      el.textContent = timeLeft;
      
      if(countdownTimer) clearInterval(countdownTimer);
      
      countdownTimer = setInterval(() => {
        timeLeft--;
        el.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(countdownTimer);
          if (onComplete) onComplete();
        }
      }, 1000); 
    }

    // X·ª≠ l√Ω khi click ch·ªçn l√†n
    document.querySelectorAll('.lane-choice').forEach(laneBtn => {
      laneBtn.addEventListener('click', () => {
        if (phase !== "choosing") return;
        phase = "answered";
        if (countdownTimer) clearInterval(countdownTimer);

        const selected = laneBtn.dataset.lane;
        const q = questions[currentLevel];
        const isCorrect = (selected === q.correct);

        document.querySelectorAll('.lane-choice').forEach(l => l.style.pointerEvents = 'none');

        // Logic ƒê√°
        const lanes = ['A', 'B', 'C', 'D'];
        lanes.forEach(lane => {
          if (lane !== q.correct) {
            const rock = document.getElementById(`rock-${lane}`);
            rock.classList.add(`lane-${lane.toLowerCase()}`);
            rock.style.display = 'block';
          }
        });

        const bike = document.getElementById('bike');
        bike.classList.add(`lane-${selected.toLowerCase()}`);

        setTimeout(() => {
          document.querySelectorAll('.lane-choice').forEach(l => {
            if (l.dataset.lane === q.correct) l.classList.add('correct');
            else if (l.dataset.lane === selected && !isCorrect) l.classList.add('incorrect');
          });

          if (isCorrect) {
            score += 100;
            document.getElementById('scoreDisplay').textContent = `ƒêI·ªÇM: ${score}`;
            
            // --- K√çCH HO·∫†T HI·ªÜU ·ª®NG T·∫∂NG QU√Ä (RAU M√Å / NEM CHUA) ---
            triggerReward();

            setTimeout(() => showExplanation(true, q.explanation), 2500); // Ch·ªù qu√† r∆°i xong m·ªõi hi·ªán gi·∫£i th√≠ch
          } else {
            // SAI -> ƒê·ª•ng ƒë√° -> N·ªï
            bike.classList.add('crashed'); 
            
            const explosion = document.getElementById('explosion');
            explosion.classList.add(`lane-${selected.toLowerCase()}`); 
            explosion.classList.add('active'); 
            
            setTimeout(() => {
              showFlashback(() => {
                showExplanation(false, q.explanation);
              });
            }, 1200);
          }
        }, 500);
      });
    });

    // H√ÄM T·∫∂NG QU√Ä M·ªöI
    function triggerReward() {
      const isRauMa = Math.random() > 0.5; // Random 50/50
      const rewardName = isRauMa ? "1 LY RAU M√Å ü•§" : "1 CH·ª§C NEM CHUA üåØ";
      const rewardEmoji = isRauMa ? "üåø" : "üåØ"; // Icon ƒë·∫°i di·ªán
      
      // Hi·ªán th√¥ng b√°o
      const msgBox = document.getElementById('reward-message-box');
      document.getElementById('reward-name').textContent = rewardName;
      document.getElementById('reward-name').style.color = isRauMa ? "#00ff41" : "#ff006e"; // Rau m√° xanh, Nem chua h·ªìng
      msgBox.classList.add('active');

      // T·∫°o m∆∞a v·∫≠t ph·∫©m
      const container = document.getElementById('reward-container');
      container.innerHTML = ''; // X√≥a c≈©
      
      for (let i = 0; i < 20; i++) {
        const item = document.createElement('div');
        item.classList.add('reward-item');
        item.textContent = rewardEmoji;
        
        // Random v·ªã tr√≠ v√† t·ªëc ƒë·ªô bay
        item.style.left = Math.random() * 100 + "%";
        item.style.animationDuration = (2 + Math.random() * 2) + "s"; // 2s ƒë·∫øn 4s
        item.style.fontSize = (2 + Math.random() * 2) + "rem"; // To nh·ªè kh√°c nhau
        
        container.appendChild(item);
      }
    }

    function showFlashback(callback) {
      const fb = document.getElementById('flashbackOverlay');
      fb.style.display = 'flex';
      setTimeout(() => {
        fb.style.display = 'none';
        if (callback) callback();
      }, 3500); 
    }

    function showExplanation(isCorrect, text) {
      document.getElementById('laneChoices').style.display = 'none';
      const panel = document.getElementById('explanationPanel');
      const title = document.getElementById('explanationTitle');
      
      panel.style.display = 'block';
      title.textContent = isCorrect ? "‚úÖ QU√Å ƒê·ªàNH! L√ÅI XE AN TO√ÄN" : "‚ùå TAI N·∫†N KINH HO√ÄNG!";
      title.className = isCorrect ? "explanation-title correct" : "explanation-title incorrect";
      document.getElementById('explanationText').textContent = text;
    }

    document.getElementById('nextButton').addEventListener('click', () => {
      currentLevel++;
      startLevel();
    });

    function showResults() {
      document.getElementById('racingScreen').style.display = 'none';
      document.getElementById('resultsScreen').style.display = 'flex';
      
      let msg = "";
      if (score >= 700) msg = "TUY·ªÜT V·ªúI! B·∫°n l√† m·ªôt B·ªô tr∆∞·ªüng Giao th√¥ng t∆∞∆°ng lai!";
      else if (score >= 400) msg = "KH√Å T·ªêT! B·∫°n ƒë√£ hi·ªÉu r√µ v·∫•n ƒë·ªÅ, h√£y c·∫©n th·∫≠n h∆°n.";
      else msg = "C·∫¶N C·ªê G·∫ÆNG! H√£y nh·ªõ r·∫±ng sai l·∫ßm tr√™n ƒë∆∞·ªùng kh√¥ng th·ªÉ l√†m l·∫°i.";
      
      document.getElementById('finalScore').textContent = `${score}/700 ƒêI·ªÇM`;
      document.getElementById('resultsMessage').textContent = msg;
    }
  </script>
</body>
</html>